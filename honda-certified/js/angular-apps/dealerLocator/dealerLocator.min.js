var app=angular.module("findDealer",["ngSanitize"]);app.controller("findDealerCtrl",["$scope","$http","$filter",function(e,t,r){e.myData=[],e.getDirections=dl.getDirections,e.getTracking=dl.getTracking,e.IgnitionOne=dl.IgnitionOne,e.getChat=dl.getChat,e.getText=dl.getText;e.slider=25;var a=!0;e.loadDealers=function(r,n,l){e.dlError=new hcpv_rpa_util.GenError({container:$(".dl-error")}),debug&&console.log("loading dealers...");var o=function(r){var n=$("#input-search-location").val();n.length>0&&/^\d{5}$/.test(n.trim())?ngScope().zip=n:ngScope().zip=r,$(window).trigger("app.zipchanged",{zip:r}),debug&&console.log("handler1 zip:",r),$(".tmp-honda-loader").fadeIn(300),t.get("/handlers/find-dealers.ashx",{params:{zip:r,radius:a?250:e.slider}}).then(function(n){if(debug&&console.log(n),"false"!=n.data.POIResponse.Error)return debug&&console.log("No result found!"),e.dealers=[],e.$$phase||e.$apply(),void $(".tmp-honda-loader").fadeOut(300);debug&&console.log("handler2 zip:",r),t.get("/handlers/get-aggregated-inventory-data.ashx",{params:{zip:r,radius:a?250:e.slider}}).then(function(t){$(".tmp-honda-loader").fadeOut(300),null!=n.data.POIResponse.POIs?e.allDealers=n.data.POIResponse.POIs.POI:e.allDealers=[],e.allCounts=[];for(var r=(t.data.Output.Results.Aggregates.Dealers||t.data.Output.Results.Dealers).Dealer,l=0;l<r.length;l++)e.allCounts.push({DealerID:r[l]["@DealerID"],Count:r[l]["@Count"]});e.filterDealers(),a||(a=!1)},function(t){e.dlError.setMessage({msg:"Sorry about that! We’ve dispatched a team of helper-bots to get this feature back up and running soon. Please check back in a bit.",errorCode:"",closeButton:!0,template:"A"})})},function(t){e.dlError.setMessage({msg:"Sorry about that! We’ve dispatched a team of helper-bots to get this feature back up and running soon. Please check back in a bit.",errorCode:"",closeButton:!0,template:"A"})})};null!=l&&l.trim().length>0?dl_getPinCode(r,n,o):(localStorageGetItemCommon("_GeoCurrentZipCode")||"").length>0?o(localStorageGetItemCommon("_GeoCurrentZipCode")):dl_getPinCode(r,n,function(e){})},e.filterDealers=function(){var t=e.allDealers;if(null!=t){var r=[],n=e.slider;dl.clearMapPins(),dl.clearMapCircleRange();var l="";$(".tab-name").hasClass("active")&&(l=$("#input-search-name").val().toUpperCase());for(var o=0;o<t.length;o++){var i=t[o],s=parseFloat(i.Distance);s>n||($(".tab-name").hasClass("active")&&l.length>0&&i.POIName.toUpperCase().indexOf(l)<0||(i.carCount=e.getCarCount(i.POIId),i.hours=e.getHours(i),r.push(i),dl.addPinToMap(i.Latitude,i.Longitude,r.length,i.POIName,s,i.carCount)))}if(a&&0==r.length){if(25==e.slider)return e.slider=100,jQuery(".search-radius-current-range").text(e.slider),$("#search-radius-slider").slider("value",e.slider),void e.filterDealers();if(100==e.slider)return e.slider=250,jQuery(".search-radius-current-range").text(e.slider),$("#search-radius-slider").slider("value",e.slider),void e.filterDealers()}if($(".tab-name").hasClass("active")){r.sort(function(e,t){return e.POIName>t.POIName}),dl.clearMapPins();for(var o=0;o<r.length;o++){var i=r[o];dl.addPinToMap(i.Latitude,i.Longitude,o+1,i.POIName,s,i.carCount)}}dl.applyPinClustering(),console.log("filtered data: ",r),e.dealers=r,e.$$phase||e.$apply(),r.length,dl.drawMapCircleRange(null,null,n),dl.checkChatStatus()}},e.getCarCount=function(t){for(var r=e.allCounts,a=0;a<r.length;a++)if(r[a].DealerID==t)return r[a].Count;return 0},e.getHours=function(e){for(var t,r=e.Departments.Department,a=0;a<r.length;a++)if("SA"==r[a].Cd&&r[a].OperationHour)return t=r[a].OperationHour[0].text,t.replaceAll(";","<br>")}}]),app.filter("zipcodeFormat",function(){return function(e){return e?10===e.toString().length?e.toString().slice(0,5):5===e.toString().length?e.toString():e:e}}),app.filter("redirectHttps",function(){return function(e){if(!e)return"";return e.indexOf("https")<0?"//"+window.location.hostname+"/redirect.html?ref="+e:e}});