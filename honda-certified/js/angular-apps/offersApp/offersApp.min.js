var offersApp=angular.module("offersApp",[]);offersApp.factory("utils",function(){var t=function(t,e){e||(e=location.href),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+t+"=([^&#]*)",i=new RegExp(n),r=i.exec(e);return null==r?null:r[1]};return{gup:t,_console:function(){return{log:function(e){1==t("debug")&&console.log("+ offersApp: "+e)},log2:function(e){1==t("debug")&&(console.log("+ offersApp: =============== start ==============="),console.log(e),console.log("+ offersApp: ++=============== end ==============="))}}}}}),offersApp.filter("tel",function(){return function(t){if(console.log(t),!t)return"";var e=t.toString().trim().replace(/^\+/,"");if(e.match(/[^0-9]/))return t;var n,i;switch(e.length){case 1:case 2:case 3:n=e;break;default:n=e.slice(0,3),i=e.slice(3)}return i?(i=i.length>3?i.slice(0,3)+"-"+i.slice(3,7):i,("("+n+") "+i).trim()):"("+n}}),offersApp.factory("offersDataService",["$http","utils",function(t,e){var n=new e._console;return{getData:function(e){return n.log("calling "+e),t({method:"GET",url:e}).then(function(t){return n.log("call successful"),t.data},function(t){n.log("call unsuccessful")})}}}]),offersApp.controller("offersCtrl",["$scope","$sce","$http","offersDataService","utils",function(t,e,n,i,r){var o=new r._console,a=function(){var t=null,e=function(e){t=e,o.log("branded offer exists: "+e)},n=function(){return null!=t&&0!=t},i=null,r=function(t){i=t,o.log("non branded offer exists: "+t)},a=function(){return null!=i&&0!=i},s=function(){return!1===n()&&!1===a()};return{setBrandedOffer:e,brandedOfferExists:n,setNonBrandedOffer:r,nonBrandedOfferExists:a,showDealersWhenNoOffers:s}},s=new a;t.page=s;var u=function(t){var e,n,i,r,a,s,u,l,d,f,c=function(){return e},g=function(t){e=t},p=function(){var e=t.PaymentTerms.FinanceTerms.SampleFinancePayment.SampleTerm;null!=e&&void 0!=e&&g(e)},v=function(){return n},m=function(t){n=t},h=function(){var e=t.PaymentTerms.FinanceTerms.SampleFinancePayment.SampleAPR;null!=e&&void 0!=e&&m(e)},P=function(){return i},S=function(t){i=t},O=function(){var e=t.Model.ModelID;null!=e&&void 0!=e&&S(e)},M=function(){return r},I=function(t){r=t},x=function(){var e=t.Model.ModelMarketingName;null!=e&&void 0!=e&&I(e)},y=function(){return null!=a&&""!=a?"//automobiles.honda.com"+a:""},C=function(t){a=t},E=function(){return null!=a&&""!=a},A=function(){var e=t.Model.ModelStockPhotoLarge;null!=e&&void 0!=e&&C(e)},T=function(){return s},b=function(t){s=t},N=function(){var e=t.Model.SalesProgramName;null!=e&&void 0!=e&&b(e)},R=function(){return u},D=function(t){u=t},F=function(){var e=t.Model.ShortDisclaimer;null!=e&&void 0!=e&&D(e)},L=function(){return l},k=function(t){l=t},Z=function(){var e=t.Model.TermAndConditions;null!=e&&void 0!=e&&k(e)},B=function(){return d},w=function(t){d=t},_=function(){var e=t.Model.SpecialShortDescription;null!=e&&void 0!=e&&w(e)},G=function(){return f},$=function(t){f=t},j=function(){var e=t.Model.SpecialDescription;null!=e&&void 0!=e&&$(e)};return __construct=function(){o.log("Creating a branded sales offer object from ..."),o.log2(t),p(),h(),O(),x(),A(),N(),F(),Z(),_(),j()},__construct(),{getSampleTerm:c,getSampleAPR:v,getModelID:P,getModelMarketingName:M,ModelStockPhotoLargeExists:E,getModelStockPhotoLarge:y,getSalesProgramName:T,getShortDisclaimer:R,getTermAndConditions:L,getSpecialShortDescription:B,getSpecialDescription:G}},l=[],d=[],f=[];t.nonSalesBrandedOffers=l,t.nonSalesBrandedOffersData=d,t.nonSalesBrandedOffersDataExpanded=f;var c=function(t){var e,n,i,r,o,a,s,u,l,d,f,c,g,p,v,m,h,P,S,O,M,I,x,y,C,E=function(){return e};setPOIId=function(t){e=t},initPOIId=function(){var e=t.POIId;null!=e&&void 0!=e&&setPOIId(e)},getPOIType=function(){return n},setPOIType=function(t){n=t},initPOIType=function(){var e=t.POIType;null!=e&&void 0!=e&&setPOIType(e)},getPOIName=function(){return i},setPOIName=function(t){i=t},initPOIName=function(){var e=t.POIName;null!=e&&void 0!=e&&setPOIName(e)},getEmail=function(){return r},setEmail=function(t){r=t},initEmail=function(){var e=t.Email;null!=e&&void 0!=e&&setEmail(e)},getInternetAddress=function(){return o},setInternetAddress=function(t){o=t},initInternetAddress=function(){var e=t.InternetAddress;null!=e&&void 0!=e&&setInternetAddress(e)},getCorporationName=function(){return a},setCorporationName=function(t){a=t},initCorporationName=function(){var e=t.CorporationName;null!=e&&void 0!=e&&setCorporationName(e)},getAddress=function(){return s},setAddress=function(t){s=t},initAddress=function(){var e=t.Address;null!=e&&void 0!=e&&setAddress(e)},getCity=function(){return u},setCity=function(t){u=t},initCity=function(){var e=t.City;null!=e&&void 0!=e&&setCity(e)},getState=function(){return l},setState=function(t){l=t},initState=function(){var e=t.State;null!=e&&void 0!=e&&setState(e)},getZipCode=function(){return d},setZipCode=function(t){d=t},initZipCode=function(){var e=t.ZipCode;null!=e&&void 0!=e&&setZipCode(e.toString().slice(0,5))},getMailingAddress=function(){return f},setMailingAddress=function(t){f=t},initMailingAddress=function(){var e=t.MailingAddress;null!=e&&void 0!=e&&setMailingAddress(e)},getMailingCity=function(){return c},setMailingCity=function(t){c=t},initMailingCity=function(){var e=t.MailingCity;null!=e&&void 0!=e&&setMailingCity(e)},getMailingState=function(){return g},setMailingState=function(t){g=t},initMailingState=function(){var e=t.MailingState;null!=e&&void 0!=e&&setMailingState(e)},getMailingZip=function(){return p},setMailingZip=function(t){p=t},initMailingZip=function(){var e=t.MailingZip;null!=e&&void 0!=e&&setMailingZip(e)},getCountry=function(){return v},setCountry=function(t){v=t},initCountry=function(){var e=t.Country;null!=e&&void 0!=e&&setCountry(e)},getRanking=function(){return m},setRanking=function(t){m=t},initRanking=function(){var e=t.Ranking;null!=e&&void 0!=e&&setRanking(e)},getPhone=function(){return h},setPhone=function(t){h=t},initPhone=function(){var e=t.Phone;null!=e&&void 0!=e&&setPhone(e)},getPhoneExtension=function(){return P},setPhoneExtension=function(t){P=t},initPhoneExtension=function(){var e=t.PhoneExtension;null!=e&&void 0!=e&&setPhoneExtension(e)},getFax=function(){return S},setFax=function(t){S=t},initFax=function(){var e=t.Fax;null!=e&&void 0!=e&&setFax(e)},getFaxExtension=function(){return O},setFaxExtension=function(t){O=t},initFaxExtension=function(){var e=t.FaxExtension;null!=e&&void 0!=e&&setFaxExtension(e)},getPOISortOrder=function(){return M},setPOISortOrder=function(t){M=t},initPOISortOrder=function(){var e=t.POISortOrder;null!=e&&void 0!=e&&setPOISortOrder(e)},getDistance=function(){return I},setDistance=function(t){I=t},initDistance=function(){var e=t.Distance;null!=e&&void 0!=e&&setDistance(e)},getLatitude=function(){return x},setLatitude=function(t){x=t},initLatitude=function(){var e=t.Latitude;null!=e&&void 0!=e&&setLatitude(e)},getLongitude=function(){return y},setLongitude=function(t){y=t},initLongitude=function(){var e=t.Longitude;null!=e&&void 0!=e&&setLongitude(e)},getRealTimeStatus=function(){return C},setRealTimeStatus=function(t){C=t},initRealTimeStatus=function(){var e=t.RealTimeStatus;null!=e&&void 0!=e&&setRealTimeStatus(e)};return function(){initPOIId(),initPOIType(),initPOIName(),initEmail(),initInternetAddress(),initCorporationName(),initAddress(),initCity(),initState(),initZipCode(),initMailingAddress(),initMailingCity(),initMailingState(),initMailingZip(),initCountry(),initRanking(),initPhone(),initPhoneExtension(),initFax(),initFaxExtension(),initPOISortOrder(),initDistance(),initLatitude(),initLongitude(),initRealTimeStatus()}(),{getPOIId:E,getPOIType:getPOIType,setPOIType:setPOIType,getPOIName:getPOIName,setPOIName:setPOIName,getEmail:getEmail,setEmail:setEmail,getInternetAddress:getInternetAddress,setInternetAddress:setInternetAddress,getCorporationName:getCorporationName,setCorporationName:setCorporationName,getAddress:getAddress,setAddress:setAddress,getCity:getCity,setCity:setCity,getState:getState,setState:setState,getZipCode:getZipCode,setZipCode:setZipCode,getMailingAddress:getMailingAddress,setMailingAddress:setMailingAddress,getMailingCity:getMailingCity,setMailingCity:setMailingCity,getMailingState:getMailingState,setMailingState:setMailingState,getMailingZip:getMailingZip,setMailingZip:setMailingZip,getCountry:getCountry,setCountry:setCountry,getRanking:getRanking,setRanking:setRanking,getPhone:getPhone,setPhone:setPhone,getPhoneExtension:getPhoneExtension,setPhoneExtension:setPhoneExtension,getFax:getFax,setFax:setFax,getFaxExtension:getFaxExtension,setFaxExtension:setFaxExtension,getPOISortOrder:getPOISortOrder,setPOISortOrder:setPOISortOrder,getDistance:getDistance,setDistance:setDistance,getLatitude:getLatitude,setLatitude:setLatitude,getLongitude:getLongitude,setLongitude:setLongitude,getRealTimeStatus:getRealTimeStatus,setRealTimeStatus:setRealTimeStatus}},g=[];t.dealers=g;var p=function(){var e=localStorageGetItemCommon("_GeoCurrentZipCode");n({method:"GET",url:"handlers/find-dealers.ashx?zip="+e}).then(function(e){t.dealersError.clearMessage();var n=e.data;o.log("Dealers handler just returned following"),o.log2(n);var i=n.POIResponse.POIs.POI;if(null!=i&&void 0!=i){for(var r=0,a=i.length;r<a;r++)g.push(new c(i[r]));o.log2(g)}},function(e){t.dealersError.setMessage({msg:"Sorry about that! There seems to be a glitch in the matrix. We've dispatched a team of helper-bots to get this feature back up and running soon. Please check back in a bit.",closeButton:!0,template:"A"})})},v=function(){n({method:"GET",url:"handlers/find-specials-by-filter-handler.ashx"}).then(function(e){t.nsboError.clearMessage();var n=e.data;o.log2(n);var i="";if(null!=n.Output.Results.Specials&&n.Output.Results.Specials.hasOwnProperty("Special")&&(i=n.Output.Results.Specials.Special),void 0!=i&&null!=i){if(Array.isArray(i))for(var r=0,a=i.length;r<a;r++){var c=i[r].OfferAttributes||{},g=c.OfferAttribute||[];g.every(function(t){return"EV"!==t["@Code"]})&&d.push({part1:i[r]})}else d.push({part1:i});for(var r=0,a=d.length;r<a;r++)if(void 0!=d[r].part1.Models)if(s.setNonBrandedOffer(!0),Array.isArray(d[r].part1.Models.Model))for(var v=0,m=d[r].part1.Models.Model.length;v<m;v++)f.push({part1:d[r].part1,part2:d[r].part1.Models.Model[v]});else f.push({part1:d[r].part1,part2:d[r].part1.Models.Model});else s.setNonBrandedOffer(!1);for(var h=0,P=f.length;h<P;h++)f[h].PaymentTerms=f[h].part1.PaymentTerms,delete f[h].part1,f[h].Model=f[h].part2,delete f[h].part2;for(var h=0,P=f.length;h<P;h++)l.push(new u(f[h]))}else s.setNonBrandedOffer(!1);o.log("offers nodes: "),o.log2(f),o.log2("offer objects: "),o.log2(l),s.nonBrandedOfferExists()||s.brandedOfferExists()||p()},function(e){t.nsboError.setMessage({msg:"Sorry about that! There seems to be a glitch in the matrix. We've dispatched a team of helper-bots to get this feature back up and running soon. Please check back in a bit.",closeButton:!0,template:"A"}),s.nonBrandedOfferExists()||s.brandedOfferExists()||p()})};!function(){t.nsboError=new hcpv_rpa_util.GenError({container:$(".nsbo-general-error")}),t.dealersError=new hcpv_rpa_util.GenError({container:$(".dealers-general-error")}),document.getElementById("brandedOffer").children.length>0?(s.setBrandedOffer(!0),o.log("branded offer exists")):(s.setBrandedOffer(!1),o.log("branded offer does not exist")),v()}()}]);