"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function getQueryVariable(e){for(var o=window.location.search.substring(1),t=o.split("&"),n=0;n<t.length;n++){var a=t[n].split("=");if(a[0]==e)return a[1]}return!1}function CallRestService(e,o){$.ajax({url:e,dataType:"jsonp",jsonp:"jsonp",success:function(e){o(e),onApiSuccess()},error:function(e){debug&&console.log(e.statusText),onApiError()}})}function loadMapScenario(){function e(){var e={maxResults:5,addressSuggestions:!1,autoDetectLocation:!0},o=new Microsoft.Maps.AutosuggestManager(e),t=new Microsoft.Maps.AutosuggestManager(e);o.attachAutosuggest(".geo-search-nav-sm","#searchBoxContainer-nav-sm",onSuggestionSelected),t.attachAutosuggest(".geo-search-overlay","#searchBoxContainer-overlay",onSuggestionSelected2)}function o(e){document.getElementById("printoutPanel").innerHTML=e}Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",{callback:e,errorCallback:o,credentials:bingMapsAPIKey}),setTimeout(function(){"function"==typeof initPage||("undefined"==typeof initPage?"undefined":_typeof(initPage))==("undefined"==typeof Function?"undefined":_typeof(Function))?(debug&&console.log("Geo -  initPage()"),initPage()):debug&&console.log("Geo - initPage() Error")},500)}function onSuggestionSelected(e){onSuggestionSelectedCommon(e,1)}function onSuggestionSelected2(e){onSuggestionSelectedCommon(e,2)}function onSuggestionSelectedCommon(e,o){$(".search-box").eq(o-1).data("suggestion","");var t=getSuggestionData(e);if(mapData=t,(mapData.address||"").indexOf("United States")<0)return void errorBox.show();debug&&console.log("Lat: "+t.lat+"Lon: "+t.lon),"undefined"!=typeof Storage&&null!=t.lat&&null!=t.lon&&(localStorageSetItemCommon("_GeoTempLat",t.lat),localStorageSetItemCommon("_GeoTempLong",t.lon)),getPinCode(t.lat,t.lon,function(e,o,t){debug&&console.log("zip: "+e)}),1===o?setTimeout(function(){$(".geo-search-nav-sm").siblings(".geolocator-go").trigger("click")},1e3):2===o&&setTimeout(function(){$(".geo-search-overlay").siblings(".geolocator-go").trigger("click")},1e3)}function getSuggestionData(e){if(null!=e){debug&&console.log(e);var o={address:e.formattedSuggestion};return e.location&&(o.lat=e.location.latitude,o.lon=e.location.longitude),o}}function getPinCode(e,o,t){CallRestService("https://dev.virtualearth.net/REST/v1/Locations/"+e+","+o+"?key="+bingMapsAPIKey_AutoComplete,function(n){n.resourceSets[0].estimatedTotal>0?(t(n.resourceSets[0].resources[0].address.postalCode,e,o),onApiSuccess()):(debug&&console.log("getPinCode: Not match found!"),onApiError())})}function getLatLon(e,o){CallRestService("https://dev.virtualearth.net/REST/v1/Locations?postalCode="+e+"&key="+bingMapsAPIKey_AutoComplete,function(t){t.resourceSets[0].estimatedTotal>0?(o(t.resourceSets[0].resources[0].geocodePoints[0].coordinates[0],t.resourceSets[0].resources[0].geocodePoints[0].coordinates[1],e),onApiSuccess()):(debug&&console.log("getLatLon: Not match found!"),onApiError())})}function getLatLonFromQuery(e,o){debug&&console.log("query:",e),CallRestService("https://dev.virtualearth.net/REST/v1/Locations?q="+encodeURIComponent(e)+"&key=Ap0AObt84NcDaUThCeWOj52ZqUHv6k4TJhjLibR-DghC-semgoj-0uPbIi8r0E4j",function(e){if(e.resourceSets[0].estimatedTotal>0){for(var t,n=e.resourceSets[0].resources,a=0;a<n.length;a++)if(n[a].entityType.indexOf("Postcode")>=0){t=n[a];break}null==t&&(t=n[0]),o(t.geocodePoints[0].coordinates[0],t.geocodePoints[0].coordinates[1],t.address.countryRegion),onApiSuccess()}else debug&&console.log("getLatLonFromQuery: Not match found!"),onApiError()})}function onApiError(){debug&&console.log("No data from API or some API error!"),errorBox.show()}function onApiSuccess(){}function updateIncomingZip(e){$(".location p span").html(e),debug&&console.log("--- updateIncomingZip --- New Zip: ",e)}function notifyOtherPage(){setTimeout(function(){debug&&console.log("Geo - notifyOtherPage"),"function"==typeof initPage||("undefined"==typeof initPage?"undefined":_typeof(initPage))===("undefined"==typeof Function?"undefined":_typeof(Function))?initPage():debug&&console.log("Geo - initPage() Error")},500)}function LocalStorageSecurityCheck(){try{localStorage;try{localStorage.setItem("storage_test",1),localStorage.removeItem("storage_test"),_SecurityCheck=!1}catch(e){_SecurityCheck=!0}}catch(e){_SecurityCheck=!0}}function localStorageSetItemCommon(e,o){_SecurityCheck?(debug&&console.log("Using SET Cookies"),cookieStorage.setCookie(e,o)):(debug&&console.log("Using SET Storage"),localStorage.setItem(e,o))}function localStorageGetItemCommon(e){if(null!=e)return _SecurityCheck?(debug&&console.log("Using GET Cookies"),cookieStorage.getCookie(e)):(debug&&console.log("Using GET STORAGE"),localStorage.getItem(e));debug&&console.log("localStorageGetItemCommon Key Null")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(o,t,n){return t&&e(o.prototype,t),n&&e(o,n),o}}(),debug=!1;1==getQueryVariable("debug")&&(debug=!0)&&console.log("debug= "+debug);var clearStorage=!1;debug&&console.log("debug= "+debug+" && clearStorage= "+clearStorage);var geolocation=function(){function e(){function o(e){debug&&console.log(" Redirecting to: "+e),window.location.href=e}_classCallCheck(this,e);var t={currentZipCode:"",destination:!1},n={$nav_zip_span:$(".location p span"),$nav_location_btn:$(".location"),$geo_overlay:$(".geo-overlay"),$geo_close:$(".geo-close"),$geolocator:$(".geolocator"),$geolocatorGo:$(".geolocator-go"),$geo_input_global:$(".geo-input"),$zip_input_nav:$(".nav-zip-input"),$zip_input_nav_close:$(".close-nav-zip-input"),$nav_right:$(".navbar-right"),$nav_li_a:$(".navigation li a"),$loading_gif:$(".tmp-honda-loader")},a=["/","/dealer-locator","/special-offers","/vehicle-search","/payment-estimator","/vehicle-details"];$(document).ready(function(){LocalStorageSecurityCheck(),g.init()?l.updateNavZip(t.currentZipCode):r.getLocation();var e;$(".search-box").on("focus",function(){errorBox.hide();var o=$(this);e=setInterval(function(){var e=$(".MicrosoftMap").find("ul li"),t=e.length;if(t>0)for(var n=0;n<Math.min(3,t);n++){var a=$(e[n]),i=a.find(".line1").text()+", "+a.find(".line2").text();if(""!=i&&i.indexOf("United States")>=0){o.data("suggestion",i);break}o.data("suggestion","")}else o.data("suggestion","")},60)}),$(".search-box").on("blur",function(){clearInterval(e)}),n.$geolocatorGo.on("click",function(e){r.geoBtnGo($(this))}),n.$geo_input_global.keydown(function(e){13==event.keyCode&&r.geoBtnGo($(this).next(".geolocator-go"))}),$(".geo-search-overlay, .geo-search-nav-sm").keydown(function(e){13==e.keyCode&&(e.preventDefault(),$(this).blur(),$(this).siblings(".geolocator-go").click())}),n.$geolocator.on("click",function(e){r.getLocation()}),n.$nav_location_btn.on("click",function(e){n.$geo_input_global.val("").focus().select(),n.$zip_input_nav.show(300).toggleClass("active"),n.$nav_right.toggleClass("active")}),n.$zip_input_nav_close.on("click",function(e){n.$zip_input_nav.toggleClass("active"),n.$nav_right.toggleClass("active")}),n.$geo_close.on("click",function(e){t.destination?n.$geo_overlay.toggleClass("hidden"):o("/")}),n.$nav_li_a.on("click",function(e){var o=$(this).attr("data-destination");debug&&console.log("desPath: ",o),o&&(t.destination=!0,i.destinationURL(o))})});var i=new function(){this.showOverlay=function(){debug&&console.log("zipGate"),i.checkURL()?(debug&&console.log("zipGate.checkURL() required"),n.$geo_overlay.removeClass("hidden")):t.destination?(debug&&console.log("zipGate.checkURL() _vars.destination"),$("#wrapper").hasClass("toggled")&&($("#wrapper").toggleClass("toggled"),$("#menu-toggle").toggleClass("active"),$(".navbar-header .location").toggleClass("active")),n.$geo_overlay.removeClass("hidden")):debug&&console.log("zipGate.checkURL() not required")},this.checkURL=function(){var e=window.location.pathname;if(-1!=$.inArray(e,a))return debug&&console.log("_pathname is in inArray"),debug&&console.log("_pathname: "+e),!0},this.destinationURL=function(e){debug&&console.log("zipGate.destinationURL: "+e);for(var n=0;n<a.length;n++){if(a[n]==e)return t.destination=!0,t.destinationPath=e,g.init()?o(t.destinationPath):(debug&&console.log("No zip is available destinationURL"),r.getLocation()),!0;debug&&console.log("path: FAILEd"),o(e)}}},r=new function(){var e,o;debug&&console.log("geolocator"),this.getLocation=function(){c.init()?navigator.geolocation?navigator.geolocation.getCurrentPosition(r.setPositions,r.geoBlocked,{timeout:3e4,enableHighAccuracy:!0,maximumAge:75e3}):i.showOverlay():s.ajaxCall()},this.geoBlocked=function(){debug&&console.log("geo Blocked by user"),n.$geolocator.addClass("hidden"),i.showOverlay()},this.setPositions=function(t){e=t.coords.latitude,o=t.coords.longitude,l.updateLocalStoragePositions(e,o),getPinCode(e,o,function(e,o,t){l.updateAll(e,o,t)})},this.geoBtnGo=function(e){var o=e.prev(".search-box");$(".geo-input-error-wrapper").removeClass("active"),o.val()?getLatLonFromQuery(o.data("suggestion")||o.val(),function(t,a,i){var r=$(".geo-input-error-title span");if("United States"!==i)return $(".geo-input-error-wrapper").addClass("active"),r.html($(".geo-input").val()),$(".geo-search-overlay").addClass("form-error"),void(debug&&console.log("USA"));"undefined"!=typeof Storage&&null!=t&&null!=a&&(localStorageSetItemCommon("_GeoTempLat",t),localStorageSetItemCommon("_GeoTempLong",a)),getPinCode(t,a,function(t,a,i){var r=o.val();r.length>0&&/^\d{5}$/.test(r.trim())&&(t=r),debug&&console.log("Go: Zip:"+t),e.parent().is("#searchBoxContainer-overlay")?_satellite.track("global_zipgate_submit"):e.parent().is("#searchBoxContainer-nav-sm")&&_satellite.track("global_nav_zipfield_submit"),l.updateAll(t,a,i),n.$nav_right.hasClass("active")&&n.$nav_right.toggleClass("active")})}):o.addClass("form-error"),$(".form-error").focus(function(){$(this).removeClass("form-error")})}},s=new function(){this.ajaxCall=function(){n.$loading_gif.fadeIn(300),debug&&console.log("ajaxCall get-zip-by-ip-address.ashx"),$.ajax({type:"POST",dataType:"json",url:"/handlers/get-zip-by-ip-address.ashx",data:{},complete:function(e,o){debug&&console.log("ajax data zipcode: "+JSON.stringify(e)),"success"==o?(e=e.responseJSON,getLatLon(e.zip_code,function(e,o,t){l.updateAll(t,e,o)}),n.$loading_gif.fadeOut(300)):(i.showOverlay(),n.$loading_gif.fadeOut(300),debug&&console.log("Error ajax data zipcode: "+e.zip_code))},error:function(e,o,t){i.showOverlay(),n.$loading_gif.fadeOut(300),debug&&console.log(o,t)}})}},l=new function(){this.updateAll=function(e,n,a){debug&&console.log("setZip*updateAll"),this.updateNavZip(e),this.updateLocalStorageZip(e),this.updateLocalStoragePositions(n,a),notifyOtherPage(),t.destination&&o(t.destinationPath)},this.updateNavZip=function(e){n.$nav_zip_span.html(e),n.$geo_input_global.val(e),n.$geo_overlay.addClass("hidden"),n.$zip_input_nav.removeClass("active"),n.$nav_right.hasClass("active")&&n.$nav_right.toggleClass("active"),errorBox.hide()},this.updateLocalStorageZip=function(e){debug&&console.log("updateLocalStorageZip: "+e),"undefined"!=typeof Storage?e&&localStorageSetItemCommon("_GeoCurrentZipCode",e):console.log("Your browser does not support Web Storage")},this.updateLocalStoragePositions=function(e,o){debug&&console.log("updateLocalStoragePositions"),"undefined"!=typeof Storage&&null!=e&&null!=o&&(localStorageSetItemCommon("_GeoCurrentLat",e),localStorageSetItemCommon("_GeocurrentLong",o))}},c=new function(){this.init=function(){var e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(e=!0),e?(debug&&console.log("This is mobile"),!0):(debug&&console.log("This is desktop"),!1)}},g=new function(){this.init=function(){return t.currentZipCode=localStorageGetItemCommon("_GeoCurrentZipCode"),debug&&console.log("zipCheckLocalStorage zip: "+t.currentZipCode),!!t.currentZipCode||(debug&&console.log("_vars.currentZipCode: Zip is NUll/Not there "+t.currentZipCode),!1)}}}return _createClass(e,null,[{key:"displayZip",value:function(e){_elements.$nav_zip_span.html(e)}},{key:"updateZip",value:function(e){"undefined"!=typeof Storage?e&&localStorageSetItemCommon("_GeoCurrentZipCode",e):console.log("Your browser does not support Web Storage")}}]),e}(),mapData,errorBox=new function(){debug&&console.log("errorBox");var e=$(".geo-input-error-title span");e.html(""),$(".geo-search-overlay").removeClass("form-error"),this.show=function(){$(".geo-input-error-wrapper").addClass("active"),e.html($(".geo-input").val()),$(".geo-search-overlay").addClass("form-error")},this.hide=function(){$(".geo-input-error-wrapper").removeClass("active"),$(".geo-search-overlay").removeClass("form-error")}};$(window).on("app.zipchanged",function(e,o){updateIncomingZip(o.zip),"undefined"!=typeof Storage?(o.zip&&localStorageSetItemCommon("_GeoCurrentZipCode",o.zip),debug&&console.log("--- dl zip changed --- New Zip"+o.zip)):console.log("Your browser does not support Web Storage")});var cookieStorage=new function(){this.getCookie=function(e){var o=Cookies.get(e);return o?(debug&&console.log("cookie is defined if: "+o),Cookies.get(e)):(debug&&console.log("cookie is undefined else"),!1)},this.setCookie=function(e,o){debug&&console.log("setCookie "+e+" "+o),Cookies.set(e,o)}},_SecurityCheck=!1;
//# sourceMappingURL=geolocation.js.map
