"use strict";function _classCallCheck(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function getQueryVariable(o){for(var e=window.location.search.substring(1),t=e.split("&"),n=0;n<t.length;n++){var a=t[n].split("=");if(a[0]==o)return a[1]}return!1}function dl_CallRestService(o,e){$.ajax({url:o,dataType:"jsonp",jsonp:"jsonp",success:function(o){e(o),dl_onApiSuccess&&dl_onApiSuccess()},error:function(o){geoDebug&&console.log(o.statusText),dl_onApiError()}})}function dl_loadMapScenario(){function o(){var o={maxResults:5,addressSuggestions:!1,autoDetectLocation:!0};new Microsoft.Maps.AutosuggestManager(o).attachAutosuggest("#input-search-location",".input-search-location-container",function(o,e){var t=dl_getSuggestionData(o);if(mapData=t,(mapData.address||"").indexOf("United States")<0)return void errorDealerBox.show();$("#input-search-location").data("suggestion",""),geoDebug&&console.log("Lat: "+t.lat+"Lon: "+t.lon),"undefined"!=typeof Storage&&null!=t.lat&&null!=t.lon&&(localStorageSetItemCommon("_GeoTempLat",t.lat),localStorageSetItemCommon("_GeoTempLong",t.lon)),dl_getPinCode(t.lat,t.lon,function(o,e,t){dl.centerMap(e,t),ngScope().loadDealers(e,t,o)})})}function e(o){console.error("error:",o)}Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",{callback:o,errorCallback:e,credentials:bingMapsAPIKey})}function dl_getSuggestionData(o){if(null!=o){geoDebug&&console.log(o);var e={address:o.formattedSuggestion};return o.location&&(e.lat=o.location.latitude,e.lon=o.location.longitude),e}}function dl_getPinCode(o,e,t){dl_CallRestService("https://dev.virtualearth.net/REST/v1/Locations/"+o+","+e+"?key="+bingMapsAPIKey_AutoComplete,function(n){n.resourceSets[0].estimatedTotal>0&&null!=n.resourceSets[0].resources[0].address.postalCode?(t&&t(n.resourceSets[0].resources[0].address.postalCode,o,e),dl_onApiSuccess()):(geoDebug&&console.log("dl_getPinCode: Not match found!"),dl_onApiError())})}function dl_getLatLon(o,e){dl_CallRestService("https://dev.virtualearth.net/REST/v1/Locations?postalCode="+o+"&key="+bingMapsAPIKey_AutoComplete,function(t){t.resourceSets[0].estimatedTotal>0?(e(t.resourceSets[0].resources[0].geocodePoints[0].coordinates[0],t.resourceSets[0].resources[0].geocodePoints[0].coordinates[1],o),dl_onApiSuccess()):(geoDebug&&console.log("dl_getLatLon: Not match found!"),dl_onApiError())})}function dl_getLatLonFromQuery(o,e){geoDebug&&console.log("query:",o),dl_CallRestService("https://dev.virtualearth.net/REST/v1/Locations?q="+encodeURIComponent(o)+"&key=Ap0AObt84NcDaUThCeWOj52ZqUHv6k4TJhjLibR-DghC-semgoj-0uPbIi8r0E4j",function(o){if(console.log(o),o.resourceSets[0].estimatedTotal>0){for(var t,n=o.resourceSets[0].resources,a=0;a<n.length;a++)if(n[a].entityType.indexOf("Postcode")>=0){t=n[a];break}null==t&&(t=n[0]),e(t.geocodePoints[0].coordinates[0],t.geocodePoints[0].coordinates[1],t.address.countryRegion),dl_onApiSuccess()}else geoDebug&&console.log("dl_getLatLonFromQuery: Not match found!"),dl_onApiError()})}function dl_onApiError(){geoDebug&&console.log("No data from API or some API error!"),errorDealerBox.show()}function dl_onApiSuccess(){}function updateZip(o){dl_getLatLon(o,function(o,e,t){dl.centerMap(o,e),ngScope().loadDealers(o,e,t)})}var geoDebug=!1,clearStorage=!1;1==getQueryVariable("debug")&&(geoDebug=!0)&&console.log("geoDebug= "+geoDebug+" && clearStorage= "+clearStorage);var dealergeolocation=function o(){_classCallCheck(this,o),$(document).ready(function(){var o;$("#input-search-location").on("focus",function(){$(".input-search-location-error").hide();var e=$(this);o=setInterval(function(){var o=$(".MicrosoftMap").find("ul li"),t=o.length;if(t>0)for(var n=0;n<Math.min(3,t);n++){var a=$(o[n]),r=a.find(".line1").text()+", "+a.find(".line2").text();if(""!=r&&r.indexOf("United States")>=0){e.data("suggestion",r);break}}else e.data("suggestion","")},60)}),$("#input-search-location").on("blur",function(){clearInterval(o)})})},dgl=new dealergeolocation,mapData,errorDealerBox=new function(){this.show=function(){$(".input-search-location-error").show()},this.hide=function(){$(".input-search-location-error").hide()}};$(function(){$(".input-search-location-go").on("click",function(){$(".input-search-location-error").hide();var o=$("#input-search-location");o.val()?dl_getLatLonFromQuery(o.data("suggestion")||o.val(),function(o,e,t){if("United States"!==t)return void $(".input-search-location-error").show();dl_getPinCode(o,e,function(o,e,t){geoDebug&&console.log("Go: Zip:"+o),dl.centerMap(e,t),ngScope().loadDealers(e,t,o)})}):o.addClass("form-error")}),$("#input-search-location").on("keydown",function(o){13==o.keyCode&&($(this).blur(),$(".input-search-location-go").click())})});
//# sourceMappingURL=dealer-locator-geo.js.map
