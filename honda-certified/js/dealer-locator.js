"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function initPage(){dl_loadMapScenario(),dl.initPage(localStorageGetItemCommon("_GeoCurrentZipCode")),floodLightSessionManager("hcpvd0")}var DealerLocator=function e(){_classCallCheck(this,e);var t={isLoading:!0,map:"xxxx",infobox:null,pushpins:[],isRangeSliderChanging:null,rangeChangeTimeout:null,lastZoomLevel:null,userChangedZoom:!1,pinIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"><circle cx="15" cy="15" r="15" fill="#000" stroke="darkred" stroke-width="0" /></svg>',clusterIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50"><circle cx="25" cy="25" r="25" fill="#000" font-family="Verdana" stroke="#fff" stroke-width="1" /><text xmlns="http://www.w3.org/2000/svg" font-family="Verdana" text-anchor="middle" fill="#fff"><tspan x="50%" y="-5%" font-size="20px" dy="1.2em">{0}</tspan><tspan x="50%" y="50%" font-size="10px" dy="1.2em">Dealers</tspan></text></svg>',pinIconActive:'<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"><circle cx="15" cy="15" r="15" fill="#007cc3" stroke="darkred" stroke-width="0" /></svg>'},o={$search_radius_slider:$("#search-radius-slider"),mapPanel:document.getElementsByClassName("map-panel")[0]};this.initPage=function(e){dl.initMap(function(){e?dl_getLatLon(e,function(e,o){ngScope().loadDealers(e,o),t.isLoading=!1}):debug&&console.log("Zip code not available. Cannot proceed.")})},this.initMap=function(e){Microsoft&&(t.map=new Microsoft.Maps.Map(o.mapPanel,{credentials:bingMapsAPIKey,showDashboard:!0,showLocateMeButton:!1,showMapTypeSelector:!1,enableClickableLogo:!1,enableSearchLogo:!1,showCopyright:!1,showScalebar:!1,disableScrollWheelZoom:!0}),localStorageGetItemCommon("_GeoTempLat")&&localStorageGetItemCommon("_GeoTempLong")&&this.centerMap(localStorageGetItemCommon("_GeoTempLat"),localStorageGetItemCommon("_GeoTempLong")),t.infobox=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0),{visible:!1}),t.infobox.setMap(t.map),Microsoft.Maps.loadModule("Microsoft.Maps.SpatialMath",function(){Microsoft.Maps.loadModule("Microsoft.Maps.Clustering",function(){e&&e()})}),Microsoft.Maps.Events.addHandler(t.map,"viewchangeend",function(e){dl.onMapMoved(e)}))},this.showInfoBox=function(e,o){$(".search-result").removeClass("active").filter("[data-pinnumber="+e.metadata.pinNumber+"]").addClass("active"),t.infobox&&t.infobox.setOptions({location:e.getLocation(),title:e.metadata.title,description:e.metadata.description,visible:!0,offset:new Microsoft.Maps.Point(0,25)}),t.infobox.metadata={clicked:o};for(var n=0;n<t.pushpins.length;n++){var a=t.pushpins[n];a&&a.setOptions({icon:t.pinIcon})}e&&e.setOptions({icon:t.pinIconActive})},this.hideInfoBox=function(e){$(".search-result").removeClass("active"),t.infobox&&t.infobox.setOptions({visible:!1}),e&&e.setOptions({icon:t.pinIcon})},this.onMapMoved=function(e){if(!t.isLoading){var o=t.map.getZoom();if(t.lastZoomLevel!=o)return t.lastZoomLevel=o,void(t.userChangedZoom=!0);if(1!=t.isRangeSliderChanging){var n=t.map.getCenter();dl_getPinCode(n.latitude,n.longitude,function(e,t,o,a){if(debug&&console.log(e),!a||!a.countryRegion||"United States"==a.countryRegion){dl.drawMapCircleRange(n.latitude,n.longitude,angular.element(document.querySelector("#search-radius-slider")).scope().slider);var i=$("#input-search-location").val();i.length>0&&/^\d{5}$/.test(i.trim())&&(e=i),ngScope().zip=e,ngScope().$$phase||ngScope().$apply(),$(window).trigger("app.zipchanged",{zip:e});$(".search-onmove").prop("checked")?dl.refreshData():($(".input-search-location-error").hide(),$(".redo-search").removeClass("hidden"),$(".search-onmove-copy, .check-box").addClass("hidden"))}})}}},this.onRedoSearch=function(){$(".redo-search").addClass("hidden"),$(".search-onmove-copy, .check-box").removeClass("hidden"),dl.refreshData()},this.refreshData=function(e){if(clearTimeout(t.rangeChangeTimeout),t.isRangeSliderChanging=!0,t.rangeChangeTimeout=setTimeout(function(){t.isRangeSliderChanging=!1},500),!0!==e){var o=t.map.getCenter();dl_getPinCode(o.latitude,o.longitude,function(e){angular.element(document.querySelector("#search-radius-slider")).scope().loadDealers(o.latitude,o.longitude,e)})}else ngScope().filterDealers()},this.clearMapCircleRange=function(){for(var e=t.map.entities.getLength()-1;e>=0;e--){t.map.entities.get(e)instanceof Microsoft.Maps.Polygon&&t.map.entities.removeAt(e)}},this.drawMapCircleRange=function(e,o,n){if(dl.clearMapCircleRange(),null==e){var a=t.map.getCenter();e=a.latitude,o=a.longitude}if(Microsoft.Maps.SpatialMath){var i=Microsoft.Maps.SpatialMath.getRegularPolygon(new Microsoft.Maps.Location(e,o),n,36,Microsoft.Maps.SpatialMath.DistanceUnits.Miles),s=new Microsoft.Maps.Polygon(i,{fillColor:new Microsoft.Maps.Color(100,156,228,232),strokeColor:new Microsoft.Maps.Color(100,156,228,232)});if(t.map.entities.push(s),!t.userChangedZoom){var r,c=[];r=dl.addMilesToLocation(e,o,n),c.push(new Microsoft.Maps.Location(r.lat,r.lon)),r=dl.addMilesToLocation(e,o,-1*n),c.push(new Microsoft.Maps.Location(r.lat,r.lon));var l=Microsoft.Maps.LocationRect.fromLocations(c);t.map.setView({bounds:l})}}},this.addMilesToLocation=function(e,t,o){e=Number(e),t=Number(t);var n=1609.344*o,a=89e-7*n;return{lat:e+a,lon:t+a/Math.cos(.018*e)}},this.centerMap=function(e,o){t.map.setView({center:new Microsoft.Maps.Location(e,o)})},this.clearMapPins=function(){for(var e=t.map.entities.getLength()-1;e>=0;e--){var o=t.map.entities.get(e);o instanceof Microsoft.Maps.Pushpin&&(dl.hideInfoBox(o),t.map.entities.removeAt(e))}t.map.layers.clear(),t.pushpins=[]},this.addPinToMap=function(e,o,n,a,i,s){var r=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(e,o));r&&r.setOptions({width:48,height:48,visible:!0,typeName:n+"_pin",icon:t.pinIcon,text:n.toString()}),r.metadata={description:'<div class="map-infobox"><h4>'+a+'</h4><h5 onClick="">'+i+" miles away</h5><h5>"+s+' cars</h5> <button type="button" class="btn btn-secondary map-infobox-btn-view-directions" onclick="dl.getDirections('+e+","+o+",'"+a+"'); dl.getTracking('"+a+"','dealerlocator_map_directions');\">Directions</button></div>",pinNumber:n},t.pushpins[n]=r,Microsoft.Maps.Events.addHandler(r,"mouseover",function(e){e.target.setOptions({icon:t.pinIconActive}),dl.showInfoBox(e.target,!1)}),Microsoft.Maps.Events.addHandler(r,"mouseout",function(e){0==$(".MicrosoftMap .Infobox:visible").length&&e.target.setOptions({icon:t.pinIcon}),t.infobox.metadata&&0!=t.infobox.metadata.clicked||dl.hideInfoBox(e.target)}),Microsoft.Maps.Events.addHandler(r,"click",function(e){var t=e.target.metadata.pinNumber;$(".search-result[data-pinnumber="+t+"]").click(),dl.showInfoBox(e.target,!0)})},this.applyPinClustering=function(){for(var e=[],o=0;o<t.pushpins.length;o++){var n=t.pushpins[o];null!=n&&e.push(n)}var a=new Microsoft.Maps.ClusterLayer(e,{clusteredPinCallback:function(e){var o=e.containedPushpins.length;e.setOptions({icon:t.clusterIcon.replace("{0}",o),text:""})}});t.map.layers.insert(a)},this.getDirections=function(e,t,o){var n=localStorageGetItemCommon("_GeoTempLat"),a=localStorageGetItemCommon("_GeoTempLong"),i="pos."+n+"_"+a+"_"+escape("My Location"),s="pos."+e+"_"+t+"_"+escape(o),r="https://www.bing.com/maps?rtp="+i+"~"+s;$("<a>").attr("href",r).attr("target","_blank")[0].click()},this.getTracking=function(e,t){debug&&console.log("getTracking: ",e,t),_satellite.setVar("dealername",e),_satellite.track(t)},this.IgnitionOne=function(e,t,o){console.log("IgnitionOne: ",e,t,o),IgnitionOne("dealer-locator",e,t,o)},this.getChat=function(e){var t={referenceId:e,engagementId:1,channel:"chat"};return lpTag.sdk.exec("caoEngager.startChat",t),!1},this.getText=function(e){var t=function(e){console.log("Error retrieving mtc property data for referenceId:"+referenceId)},o=function(t){var o={referenceId:e,engagementId:1,channel:"mtc",mtc:t.properties};o.mtc.phoneNumber&&lpTag.sdk.exec("caoEngager.startChat",o)};return lpTag.sdk.exec("caoEngager.getMtcProperties",{referenceId:e,onSuccess:o,onError:t}),!1},this.checkChatStatus=function(){setTimeout(function(){$(".btn-contactatonce").each(function(){function e(e){console.log(e),"online"===e.presenceStatus?(console.log("Chat is online"),o.removeClass("hidden"),a=!0):console.log("Chat is offline")}function t(){console.log("Error checking Contact At Once presence")}var o=$(this),n=o.attr("data-dealerId"),a=!1,i={referenceId:n,engagementId:1,onSuccess:e,onError:t};lpTag.sdk.exec("caoPresence.getPresence",i)})},500)},$(document).ready(function(){function e(){$(".map-panel").css("height",$(window).height()-345)}o.$search_radius_slider.slider({range:"max",step:1,min:5,max:250,value:25,slide:function(e,o){$(".search-radius-current-range").html(o.value),clearTimeout(t.rangeChangeTimeout),t.isRangeSliderChanging=!0,t.rangeChangeTimeout=setTimeout(function(){t.isRangeSliderChanging=!1},500),t.userChangedZoom=!1,angular.element(document.querySelector("#search-radius-slider")).scope().slider=o.value,angular.element(document.querySelector("#search-radius-slider")).scope().filterDealers()}}),$(".search-tab").on("click",function(e){var t=$(this).attr("data-id");$(".search-tab").removeClass("active"),$(this).addClass("active"),$(".search-options").removeClass("hidden"),$(".control-panel").find(".search-options").not("[data-id='"+t+"']").addClass("hidden")}),$(".redo-search").on("click",function(){dl.onRedoSearch()}),$("#input-search-name").on("input",function(){dl.refreshData(!0)}),$("body").on("mouseenter",".search-result",function(e){var o=$(e.target).attr("data-pinnumber")||$(e.target).closest(".search-result").attr("data-pinnumber"),n=t.pushpins[o];n&&n.setOptions({icon:t.pinIconActive})}),$("body").on("mouseleave",".search-result",function(e){var o=$(e.target).attr("data-pinnumber")||$(e.target).closest(".search-result").attr("data-pinnumber"),n=t.pushpins[o];n&&n.setOptions({icon:t.pinIcon})}),$(".search-tab").on("click",function(){ngScope().filterDealers()}),e(),$(window).resize(function(){e()}),$("body").on("click",".search-result",function(){var e=$(".control-panel");e.animate({scrollTop:e.scrollTop()-e.offset().top+$(this).offset().top},250)}),$("body").on("click",".no-scroll",function(e){e.stopPropagation()}),$("#input-search-name").on("focus click",function(e){e.stopPropagation(),$(".search-name-autocomplete").show(),ngScope().filterDealers()}),$(".search-name-autocomplete").on("click",".search-name-autocomplete-item",function(e){var t=$(e.target);$("#input-search-name").val(t.text()),ngScope().filterDealers(),$(".search-name-autocomplete").hide()}),$("body").on("click",function(){$(".search-name-autocomplete").hide()})})},ngScope=function(){return angular.element(document.querySelector("#search-radius-slider")).scope()},dl=new DealerLocator;
//# sourceMappingURL=dealer-locator.js.map
